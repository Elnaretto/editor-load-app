<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="container py-4">
<div class="mb-4 d-flex gap-2">
    <a href="{{ url_for('index') }}" class="btn btn-outline-primary">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="{{ url_for('visualization') }}" class="btn btn-outline-success">üìä –ü–æ —à–µ—Ñ—É</a>
    <a href="{{ url_for('visualization_timeline') }}" class="btn btn-outline-info">üìà –î–∏–Ω–∞–º–∏–∫–∞</a>
    <a href="{{ url_for('visualization_editors') }}" class="btn btn-outline-info" >üëå–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤</a>
</div>
    <!-- –ù–∞–∑–∞–¥ -->
    <div class="mb-3">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">&larr; –ù–∞–∑–∞–¥</a>
    </div>

<h1>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h1>

<label for="editor-select">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:</label>
<select id="editor-select" class="form-select w-auto mb-3">
  <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ --</option>
  {% for editor in editors %}
    <option value="{{ editor.id }}">{{ editor.login }}</option>
  {% endfor %}
</select>

<label for="date-select">–î–∞—Ç–∞:</label>
<input type="date" id="date-select" value="{{ today }}" class="form-control w-auto mb-3" />

<h3>–ù–∞–≥—Ä—É–∑–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º:</h3>
<table class="table table-bordered w-auto" id="loads-table" style="display:none;">
  <thead>
    <tr>
      <th>–ü—Ä–æ–µ–∫—Ç</th>
      <th>–ß–∞—Å—ã</th>
    </tr>
  </thead>
  <tbody id="loads-body"></tbody>
</table>

<p id="no-data" style="display:none;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏ –¥–∞—Ç—ã.</p>

<script>
async function loadEditorData() {
  const editorId = document.getElementById('editor-select').value;
  const date = document.getElementById('date-select').value;

  const table = document.getElementById('loads-table');
  const tbody = document.getElementById('loads-body');
  const noData = document.getElementById('no-data');

  tbody.innerHTML = '';
  table.style.display = 'none';
  noData.style.display = 'none';

  if (!editorId) return;

  try {
    const response = await fetch(`/get_editor_loads?editor_id=${editorId}&date=${date}`);
    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    const data = await response.json();

    if (data.loads.length === 0) {
      noData.style.display = 'block';
      return;
    }

    data.loads.forEach(load => {
      const row = document.createElement('tr');
      row.innerHTML = `<td>${load.project_name}</td><td>${load.hours}</td>`;
      tbody.appendChild(row);
    });

    table.style.display = 'table';

  } catch(e) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö');
    console.error(e);
  }
}

document.getElementById('editor-select').addEventListener('change', loadEditorData);
document.getElementById('date-select').addEventListener('change', loadEditorData);
</script>

</body>
</html>
